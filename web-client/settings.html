<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Settings | System Bridge</title>
    <link rel="stylesheet" href="./src/index.css" />
    <script type="module" src="/src/sb-client.ts"></script>
  </head>
  <body>
    <sb-client>
      <div class="settings-page">
        <div class="page-header">
          <h1>Connection Settings</h1>
          <p>Configure your System Bridge connection parameters</p>
        </div>
        
        <div class="settings-container">
          <div class="settings-card">
            <h3>Connection Configuration</h3>
            <div class="settings-form">
              <div class="form-group">
                <label for="host">Host</label>
                <input type="text" id="host" placeholder="localhost" />
                <small>IP address or hostname of the System Bridge server</small>
              </div>
              
              <div class="form-group">
                <label for="port">Port</label>
                <input type="number" id="port" placeholder="9170" />
                <small>Port number for the System Bridge server</small>
              </div>
              
              <div class="form-group">
                <label for="ssl">Use SSL/TLS</label>
                <input type="checkbox" id="ssl" />
                <small>Enable secure WebSocket connection (WSS)</small>
              </div>
              
              <div class="form-group">
                <label for="apiKey">API Key</label>
                <input type="password" id="apiKey" placeholder="Enter your API key" />
                <small>Authentication key for System Bridge access</small>
              </div>
              
              <div class="form-actions">
                <button type="button" id="test-connection" class="btn btn-secondary">
                  Test Connection
                </button>
                <button type="button" id="save-settings" class="btn btn-primary">
                  Save Settings
                </button>
              </div>
            </div>
          </div>
          
          <div class="settings-card">
            <h3>Current Status</h3>
            <div class="status-display">
              <div class="status-item">
                <span class="status-label">Connection Status:</span>
                <span class="status-value" id="connection-status">
                  <span class="status-indicator disconnected"></span>
                  Disconnected
                </span>
              </div>
              <div class="status-item">
                <span class="status-label">WebSocket URL:</span>
                <span class="status-value" id="websocket-url">Not configured</span>
              </div>
              <div class="status-item">
                <span class="status-label">Last Connected:</span>
                <span class="status-value" id="last-connected">Never</span>
              </div>
            </div>
          </div>
          
          <div class="settings-card">
            <h3>Advanced Settings</h3>
            <div class="advanced-settings">
              <div class="form-group">
                <label for="auto-reconnect">Auto Reconnect</label>
                <input type="checkbox" id="auto-reconnect" checked />
                <small>Automatically attempt to reconnect on connection loss</small>
              </div>
              
              <div class="form-group">
                <label for="reconnect-interval">Reconnect Interval (ms)</label>
                <input type="number" id="reconnect-interval" value="1500" min="1000" max="10000" />
                <small>Delay between reconnection attempts</small>
              </div>
              
              <div class="form-group">
                <label for="debug-mode">Debug Mode</label>
                <input type="checkbox" id="debug-mode" />
                <small>Enable detailed logging for troubleshooting</small>
              </div>
            </div>
          </div>
        </div>
        
        <div class="navigation-footer">
          <a href="/" class="nav-link">← Back to Home</a>
          <a href="/data" class="nav-link">View Data →</a>
        </div>
      </div>
    </sb-client>
    
    <style>
      .settings-page {
        max-width: 800px;
        margin: 0 auto;
        padding: 2rem;
      }
      
      .page-header {
        text-align: center;
        margin-bottom: 2rem;
      }
      
      .page-header h1 {
        font-size: 2.5rem;
        font-weight: 700;
        color: #1f2937;
        margin-bottom: 0.5rem;
      }
      
      .page-header p {
        font-size: 1.125rem;
        color: #6b7280;
      }
      
      .settings-container {
        display: flex;
        flex-direction: column;
        gap: 2rem;
        margin-bottom: 2rem;
      }
      
      .settings-card {
        background: white;
        border-radius: 0.75rem;
        padding: 2rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        border: 1px solid #e5e7eb;
      }
      
      .settings-card h3 {
        font-size: 1.25rem;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 1.5rem;
        border-bottom: 2px solid #e5e7eb;
        padding-bottom: 0.5rem;
      }
      
      .form-group {
        margin-bottom: 1.5rem;
      }
      
      .form-group label {
        display: block;
        font-weight: 500;
        color: #374151;
        margin-bottom: 0.5rem;
      }
      
      .form-group input {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #d1d5db;
        border-radius: 0.5rem;
        font-size: 1rem;
        transition: border-color 0.2s ease;
      }
      
      .form-group input:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }
      
      .form-group input[type="checkbox"] {
        width: auto;
        margin-right: 0.5rem;
      }
      
      .form-group small {
        display: block;
        color: #6b7280;
        font-size: 0.875rem;
        margin-top: 0.25rem;
      }
      
      .form-actions {
        display: flex;
        gap: 1rem;
        margin-top: 2rem;
      }
      
      .btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 0.5rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 1rem;
      }
      
      .btn-primary {
        background-color: #3b82f6;
        color: white;
      }
      
      .btn-primary:hover {
        background-color: #2563eb;
      }
      
      .btn-secondary {
        background-color: #6b7280;
        color: white;
      }
      
      .btn-secondary:hover {
        background-color: #4b5563;
      }
      
      .status-display {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      
      .status-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        background: #f9fafb;
        border-radius: 0.5rem;
        border: 1px solid #e5e7eb;
      }
      
      .status-label {
        font-weight: 500;
        color: #374151;
      }
      
      .status-value {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 0.875rem;
        color: #6b7280;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      
      .status-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        display: inline-block;
      }
      
      .status-indicator.connected {
        background-color: #10b981;
      }
      
      .status-indicator.disconnected {
        background-color: #ef4444;
      }
      
      .navigation-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-top: 2rem;
        border-top: 1px solid #e5e7eb;
      }
      
      .nav-link {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1.5rem;
        background-color: #3b82f6;
        color: white;
        text-decoration: none;
        border-radius: 0.5rem;
        font-weight: 500;
        transition: all 0.2s ease;
      }
      
      .nav-link:hover {
        background-color: #2563eb;
        transform: translateY(-1px);
      }
      
      @media (max-width: 640px) {
        .settings-page {
          padding: 1rem;
        }
        
        .form-actions {
          flex-direction: column;
        }
        
        .navigation-footer {
          flex-direction: column;
          gap: 1rem;
        }
      }
    </style>
    
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const client = document.querySelector('sb-client-main');
        if (!client) return;
        
        // Load current settings
        loadCurrentSettings();
        
        // Set up event listeners
        document.getElementById('test-connection').addEventListener('click', testConnection);
        document.getElementById('save-settings').addEventListener('click', saveSettings);
        
        // Update status display
        updateStatusDisplay();
        
        // Listen for connection changes
        const statusInterval = setInterval(updateStatusDisplay, 1000);
        
        function loadCurrentSettings() {
          const settings = client.connectionSettings || {};
          document.getElementById('host').value = settings.host || 'localhost';
          document.getElementById('port').value = settings.port || 9170;
          document.getElementById('ssl').checked = settings.ssl || false;
          document.getElementById('apiKey').value = settings.apiKey || '';
        }
        
        function saveSettings() {
          const settings = {
            host: document.getElementById('host').value || 'localhost',
            port: parseInt(document.getElementById('port').value) || 9170,
            ssl: document.getElementById('ssl').checked,
            apiKey: document.getElementById('apiKey').value
          };
          
          // Update connection settings
          client.updateConnectionSettings(settings);
          client.saveConnectionSettingsToSession();
          
          // Update WebSocket URL
          client.setWebSocketUrl(client.getWebSocketUrl());
          
          // Show success message
          alert('Settings saved successfully!');
          updateStatusDisplay();
        }
        
        function testConnection() {
          const button = document.getElementById('test-connection');
          const originalText = button.textContent;
          
          button.textContent = 'Testing...';
          button.disabled = true;
          
          // Save current settings first
          saveSettings();
          
          // Attempt to connect
          client.connect();
          
          // Check connection status after a delay
          setTimeout(() => {
            if (client.isConnected) {
              alert('Connection test successful!');
            } else {
              alert('Connection test failed. Please check your settings.');
            }
            button.textContent = originalText;
            button.disabled = false;
            updateStatusDisplay();
          }, 2000);
        }
        
        function updateStatusDisplay() {
          const statusElement = document.getElementById('connection-status');
          const urlElement = document.getElementById('websocket-url');
          const lastConnectedElement = document.getElementById('last-connected');
          
          if (client.isConnected) {
            statusElement.innerHTML = '<span class="status-indicator connected"></span>Connected';
            urlElement.textContent = client.getWebSocketUrl();
            lastConnectedElement.textContent = new Date().toLocaleString();
          } else {
            statusElement.innerHTML = '<span class="status-indicator disconnected"></span>Disconnected';
            urlElement.textContent = 'Not configured';
            lastConnectedElement.textContent = 'Never';
          }
        }
      });
    </script>
  </body>
</html>