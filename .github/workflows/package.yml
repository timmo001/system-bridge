---
name: "Package Application"

# yamllint disable-line rule:truthy
on:
  push:
    branches:
      - master
  pull_request:
    types:
      - opened
      - reopened
      - synchronize
  release:
    types:
      - published
  workflow_call:
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}-${{ github.head_ref || github.ref }}
  cancel-in-progress: true

jobs:
  package-backend-linux:
    uses: timmo001/workflows/.github/workflows/package-python-pyinstaller-linux.yml@master
    with:
      additional-pyinstaller-options: |
        --onedir \
        --windowed \
        --icon "resources/system-bridge.png" \
        --name "systembridgebackend" \
        --collect-all "plyer" \
        --collect-all "systembridgebackend" \
        --collect-all "systembridgefrontend" \
      create-setup: true
      entry-point-file: https://raw.githubusercontent.com/timmo001/system-bridge-backend/master/systembridgebackend/__main__.py
      name: "systembridgebackend"
      pre-package-command: |
        pip install -r requirements_linux.txt
      upload-executable: true
  package-backend-windows:
    uses: timmo001/workflows/.github/workflows/package-python-pyinstaller-windows.yml@master
    with:
      additional-pyinstaller-options: |
        --onedir `
        --windowed `
        --icon "resources/system-bridge.ico" `
        --name "systembridgebackend" `
        --collect-all "plyer" `
        --collect-all "pywin32" `
        --collect-all "winsdk" `
        --collect-all "systembridgebackend" `
        --collect-all "systembridgefrontend" `
        --collect-all "systembridgewindowssensors" `
      create-setup: true
      entry-point-file: https://raw.githubusercontent.com/timmo001/system-bridge-backend/master/systembridgebackend/__main__.py
      name: "systembridgebackend"
      pre-package-command: |
        pip install -r requirements_windows.txt
      upload-executable: true
